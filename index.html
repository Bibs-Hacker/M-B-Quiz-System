<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MERA-B Quiz Universe — Full Real-time (Firestore)</title>
<style>
  :root{--bg:#071126;--card:#0f1724;--accent:#7c3aed;--muted:#9ca3af;--glass:rgba(255,255,255,0.03);}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#020617 0%, #0b1220 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
  .app{width:100%;max-width:1100px;min-height:640px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.6);display:grid;grid-template-rows:auto 1fr auto;gap:12px}
  header{display:flex;justify-content:space-between;align-items:center}
  .title{font-weight:800;font-size:20px;color:var(--accent)}
  .subtitle{color:var(--muted);font-size:13px}
  main{display:grid;grid-template-columns:1fr 380px;gap:18px}
  .panel{background:var(--card);border-radius:12px;padding:14px}
  .centered{display:flex;align-items:center;justify-content:center;flex-direction:column}
  .hidden{display:none}
  .splash{height:380px;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center}
  .logo{font-size:34px;font-weight:900;letter-spacing:1px;color:var(--accent);text-shadow:0 6px 30px rgba(124,58,237,0.12)}
  .muted{color:var(--muted)}
  input,select,button,textarea{font-family:inherit}
  .form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
  input[type=text],input[type=email],input[type=tel],select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .btn{background:var(--accent);border:none;padding:10px 12px;border-radius:10px;color:white;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .card{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  .card:hover{box-shadow:0 12px 40px rgba(124,58,237,0.06);transform:translateY(-4px)}
  .question{font-weight:700;margin-bottom:10px}
  .options{display:flex;flex-direction:column;gap:8px}
  .option{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .option.selected{outline:2px solid rgba(124,58,237,0.3)}
  .progress{height:10px;background:rgba(255,255,255,0.03);border-radius:12px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#a78bfa)}
  footer{display:flex;justify-content:space-between;align-items:center;padding-top:8px}
  .small{font-size:12px;color:var(--muted)}
  .admin-panel{max-height:520px;overflow:auto}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
  @media (max-width:900px){main{grid-template-columns:1fr} .cards{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div>
      <div class="title">MERA-B Quiz Universe</div>
      <div class="subtitle">A big, real-time Firestore-powered quiz portal</div>
    </div>
    <div class="small">© 2025 MERA-B Systems</div>
  </header>  <main>
    <!-- Left: main views -->
    <div>
      <!-- Views switch by data-view attribute -->
      <div class="panel" data-view="splash">
        <div class="splash">
          <div class="logo">MERA‑B</div>
          <div class="muted" style="margin-top:12px">Quiz Universe — loading the experience</div>
          <div style="height:20px"></div>
          <div class="progress" style="width:60%"><i id="splashProg" style="width:0%"></i></div>
        </div>
      </div><div class="panel hidden" data-view="login">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Welcome — Sign in</div>
      <div class="muted">Enter your details to continue</div>
    </div>
    <div class="form-row">
      <label class="muted">Full name</label>
      <input id="u_name" type="text" placeholder="Jane Doe" />
    </div>
    <div class="form-row">
      <label class="muted">Email</label>
      <input id="u_email" type="email" placeholder="you@example.com" />
    </div>
    <div class="form-row">
      <label class="muted">Phone</label>
      <input id="u_phone" type="tel" placeholder="+2547..." />
    </div>
    <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
      <button id="loginContinue" class="btn">Continue</button>
      <button id="loginReset" class="btn ghost">Clear</button>
    </div>
  </div>

  <div class="panel hidden" data-view="loading">
    <div class="centered" style="height:320px">
      <div style="font-weight:800;font-size:20px">Preparing your experience...</div>
      <div class="muted" style="margin-top:8px">MERA-B Quiz Universe</div>
      <div style="height:18px"></div>
      <div class="progress" style="width:70%"><i id="loadingProg" style="width:0%"></i></div>
    </div>
  </div>

  <div class="panel hidden" data-view="categories">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div style="font-weight:800">Choose a Category</div>
      <div><button id="logoutBtn" class="btn ghost">Edit Details</button></div>
    </div>
    <div class="cards" id="categoryCards"></div>
  </div>

  <div class="panel hidden" data-view="quiz">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800" id="quizCatTitle">Quiz</div>
      <div class="muted"><button id="backToCats" class="btn ghost">Back</button></div>
    </div>
    <div id="quizWrap">
      <div class="question" id="qText">Question text</div>
      <div class="options" id="optionsWrap"></div>
      <div style="height:12px"></div>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="muted">Question <span id="qIdx">1</span>/<span id="qTotal">1</span></div>
        <div style="display:flex;gap:8px"><button id="prevQ" class="btn ghost">Prev</button><button id="nextQ" class="btn ghost">Next</button><button id="finishQ" class="btn">Finish</button></div>
      </div>
      <div style="height:8px"></div>
      <div class="progress"><i id="quizProg" style="width:0%"></i></div>
    </div>
  </div>

  <div class="panel hidden" data-view="result">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Your Result</div>
      <div class="muted">Congrats — review below</div>
    </div>
    <div id="resultWrap"></div>
    <div style="height:10px"></div>
    <div style="display:flex;gap:8px"><button id="retryBtn" class="btn">Retry</button><button id="homeBtn" class="btn ghost">Home</button></div>
  </div>

</div>

<!-- Right: admin login / dashboard compact -->
<div>
  <div class="panel" data-view="adminLogin">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Admin Portal</div>
      <div class="muted">Secure access</div>
    </div>
    <div class="form-row">
      <label class="muted">Admin email</label>
      <input id="admin_email" type="email" placeholder="admin@you.com" />
    </div>
    <div class="form-row">
      <label class="muted">Password</label>
      <input id="admin_pass" type="password" placeholder="••••••••" />
    </div>
    <div style="display:flex;gap:8px"><button id="adminLoginBtn" class="btn">Sign In</button><button id="adminLogoutBtn" class="btn ghost hidden">Sign Out</button></div>
    <div style="height:10px"></div>
    <div class="small muted">Note: Create an admin user via Firebase Auth first, or use the admin console to seed credentials.</div>
  </div>

  <div class="panel hidden" data-view="adminDash">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Admin Dashboard</div>
      <div class="muted">Live</div>
    </div>
    <div class="admin-panel" id="adminPanel">
      <div class="small muted">Totals: <span id="totalUsers">0</span> users • <span id="totalAttempts">0</span> attempts</div>
      <div style="height:8px"></div>
      <div style="font-weight:700">Recent Attempts</div>
      <div id="attemptList"></div>
      <div style="height:12px"></div>
      <div style="font-weight:700">Users</div>
      <div id="userList"></div>
    </div>
  </div>

</div>

  </main>  <footer>
    <div class="small">Favorite title: <strong id="favTitle">MERA-B Quiz Universe</strong></div>
    <div class="small">Powered by MERA-B Systems</div>
  </footer>
</div><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script><script>
/* =========================
   IMPORTANT: Replace the firebaseConfig object below with your project's settings.
   1) Go to Firebase console -> Project settings -> SDK setup and config
   2) Paste the config values into firebaseConfig
   3) Enable Firestore and Firebase Auth (Email/Password)
   4) Create an admin user in Auth for admin login, or use the console
   ========================= */
const firebaseConfig = {
  apiKey: "AIzaSyD8GRrVG61SxIwXqiVCE4YV72qvFK7fadg",
  authDomain: "mera-b.firebaseapp.com",
  projectId: "mera-b",
  storageBucket: "mera-b.firebasestorage.app",
  messagingSenderId: "380526911045",
  appId: "1:380526911045:web:f5f858392c4955ba0ecd2c"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* =========================
   App state
   ========================= */
const V = (v)=>document.querySelector(`[data-view="${v}"]`);
let state = {
  view: 'splash',
  user: null,
  currentCategory: null,
  questions: [],
  answers: [],
  currentIndex: 0
};

/* =========================
   Sample questions: add more categories freely
   ========================= */
const QUESTIONS_BY_CATEGORY = {
  "General Knowledge": [
    {q:"What is the capital of France?", choices:["Paris","Berlin","Rome","Madrid"], a:0},
    {q:"Which planet is called the Red Planet?", choices:["Venus","Mars","Jupiter","Saturn"], a:1}
  ],
  "Science": [
    {q:"H2O is the chemical formula for?", choices:["Hydrogen","Helium","Water","Oxygen"], a:2},
    {q:"Plants mainly absorb which gas?", choices:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"], a:2}
  ],
  "Programming": [
    {q:"Which language uses console.log?", choices:["Python","Ruby","JavaScript","C#"], a:2},
    {q:"Git is used for?", choices:["Design","Source control","Testing","Deployment"], a:1}
  ],
  "Sports": [
    {q:"How many players in a soccer team on the field?", choices:["9","10","11","12"], a:2}
  ]
};

/* =========================
   Helpers: view switching
   ========================= */
function showView(name){
  document.querySelectorAll('[data-view]').forEach(el=>el.classList.add('hidden'));
  V(name).classList.remove('hidden');
  state.view = name;
}

/* =========================
   Splash auto-progress -> go to login
   ========================= */
let splashPct = 0;
const splashBar = document.getElementById('splashProg');
const loadingBar = document.getElementById('loadingProg');
function startSplash(){
  showView('splash');
  splashPct = 0; splashBar.style.width='0%';
  const t = setInterval(()=>{
    splashPct += Math.random()*20;
    if(splashPct>=100){ splashBar.style.width='100%'; clearInterval(t); setTimeout(()=>showView('login'),700); return; }
    splashBar.style.width = Math.min(100,Math.round(splashPct))+'%';
  }, 400);
}

/* =========================
   Login flow (user)
   ========================= */
document.getElementById('loginContinue').onclick = async ()=>{
  const name = document.getElementById('u_name').value.trim();
  const email = document.getElementById('u_email').value.trim();
  const phone = document.getElementById('u_phone').value.trim();
  if(!name){ alert('Enter your name'); return; }
  state.user = {name, email, phone};
  // save locally for persistence
  localStorage.setItem('mera_user', JSON.stringify(state.user));
  // write or update user in Firestore (by email if available else auto-id)
  try{
    let userRef;
    if(email){
      // use email as doc id (safe-encode)
      const id = encodeURIComponent(email.toLowerCase());
      userRef = db.collection('users').doc(id);
      await userRef.set({name,email,phone, lastSeen: firebase.firestore.FieldValue.serverTimestamp()}, {merge:true});
    } else {
      userRef = db.collection('users').doc();
      await userRef.set({name, phone, createdAt: firebase.firestore.FieldValue.serverTimestamp()});
    }
  }catch(e){ console.warn('Firestore users write failed (check config & rules)', e); }

  // show loading then categories
  showView('loading');
  let pct=0; loadingBar.style.width='0%';
  const t = setInterval(()=>{ pct += Math.random()*30; loadingBar.style.width = Math.min(100,Math.round(pct))+'%'; if(pct>=100){ clearInterval(t); showCategories(); } }, 400);
};

document.getElementById('loginReset').onclick = ()=>{ document.getElementById('u_name').value=''; document.getElementById('u_email').value=''; document.getElementById('u_phone').value=''; };

/* =========================
   Categories view
   ========================= */
function showCategories(){
  // build cards
  const wrap = document.getElementById('categoryCards'); wrap.innerHTML='';
  Object.keys(QUESTIONS_BY_CATEGORY).forEach(cat=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="font-weight:800">${cat}</div><div class="muted">${QUESTIONS_BY_CATEGORY[cat].length} questions</div>`;
    el.onclick = ()=>startQuiz(cat);
    wrap.appendChild(el);
  });
  showView('categories');
}

/* =========================
   Start quiz
   ========================= */
function startQuiz(cat){
  state.currentCategory = cat;
  state.questions = JSON.parse(JSON.stringify(QUESTIONS_BY_CATEGORY[cat] || []));
  state.answers = new Array(state.questions.length).fill(null);
  state.currentIndex = 0;
  document.getElementById('quizCatTitle').textContent = cat;
  document.getElementById('qTotal').textContent = state.questions.length;
  renderQuestion();
  showView('quiz');
}

function renderQuestion(){
  const q = state.questions[state.currentIndex];
  document.getElementById('qText').textContent = q.q;
  const opts = document.getElementById('optionsWrap');
  opts.innerHTML='';
  q.choices.forEach((c,idx)=>{
    const d = document.createElement('div'); d.className='option'; d.textContent = String.fromCharCode(65+idx)+'. '+c; d.dataset.idx=idx;
    if(state.answers[state.currentIndex]===idx) d.classList.add('selected');
    d.onclick = ()=>{ state.answers[state.currentIndex]=idx; Array.from(opts.children).forEach(n=>n.classList.remove('selected')); d.classList.add('selected'); saveProgress(); };
    opts.appendChild(d);
  });
  document.getElementById('qIdx').textContent = state.currentIndex+1;
  const pct = Math.round(((state.currentIndex+1)/state.questions.length)*100);
  document.getElementById('quizProg').style.width = pct+'%';
}

document.getElementById('prevQ').onclick = ()=>{ if(state.currentIndex>0){ state.currentIndex--; renderQuestion(); } };
document.getElementById('nextQ').onclick = ()=>{ if(state.currentIndex < state.questions.length-1){ state.currentIndex++; renderQuestion(); } };
document.getElementById('backToCats').onclick = ()=>{ showCategories(); };

/* =========================
   Save progress locally so user can go back and edit details before starting
   ========================= */
function saveProgress(){
  try{ localStorage.setItem('mera_quiz_progress_'+state.currentCategory, JSON.stringify({answers:state.answers, index:state.currentIndex})); }catch(e){}
}

/* =========================
   Finish quiz: compute score, write result to Firestore
   ========================= */
document.getElementById('finishQ').onclick = async ()=>{
  // compute
  let correct=0; state.questions.forEach((q,i)=>{ if(state.answers[i]===q.a) correct++; });
  const total = state.questions.length; const score = Math.round((correct/total)*100);

  // show result UI
  const wrap = document.getElementById('resultWrap');
  wrap.innerHTML = `<div style="font-weight:900;font-size:28px">${score}%</div><div class="muted">${correct}/${total} correct</div><div style="height:12px"></div><div><button id=previewBtn class=\"btn ghost\">Preview Correct Answers</button></div>`;
  document.getElementById('previewBtn').onclick = ()=>previewAnswers();

  // persist to Firestore
  try{
    const user = state.user || JSON.parse(localStorage.getItem('mera_user')||'null') || {name:'Anon'};
    const payload = {
      userName: user.name || '', userEmail: user.email || '', userPhone: user.phone || '', category: state.currentCategory, score, correct, total, answers: state.answers, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    await db.collection('results').add(payload);
    // also update a user document record for quick admin listing
    if(user.email){
      const id = encodeURIComponent(user.email.toLowerCase());
      await db.collection('users').doc(id).set({name:user.name,email:user.email,phone:user.phone, lastAttempt: firebase.firestore.FieldValue.serverTimestamp()}, {merge:true});
    }
  }catch(e){ console.warn('Failed to write result', e); }

  showView('result');
};

function previewAnswers(){
  const wrap = document.getElementById('resultWrap');
  const html = state.questions.map((q,i)=>{
    const chosen = state.answers[i]; const correctIdx = q.a; const ok = chosen===correctIdx;
    const choices = q.choices.map((c,idx)=>`<div style=\"padding:8px;border-radius:6px;margin:6px 0;${idx===correctIdx? 'background:rgba(34,197,94,0.07);':''}${chosen===idx && !ok? 'border:1px solid rgba(239,68,68,0.2);':''}\">${String.fromCharCode(65+idx)}. ${c}${idx===correctIdx? ' ← correct':''}${chosen===idx && !ok? ' ← your answer':''}</div>`).join('');
    return `<div style=\"margin-bottom:10px\"><strong>${q.q}</strong>${choices}</div>`;
  }).join('');
  wrap.innerHTML = `<div style=\"font-weight:800;margin-bottom:8px\">Review Answers</div>${html}`;
}

document.getElementById('retryBtn').onclick = ()=>{ startQuiz(state.currentCategory); };
document.getElementById('homeBtn').onclick = ()=>{ showCategories(); };

document.getElementById('logoutBtn').onclick = ()=>{ // allow user to edit details
  showView('login');
};

/* =========================
   Admin: auth, listeners and dashboard
   ========================= */
document.getElementById('adminLoginBtn').onclick = async ()=>{
  const email = document.getElementById('admin_email').value.trim();
  const pass = document.getElementById('admin_pass').value.trim();
  if(!email||!pass){ alert('Enter admin credentials'); return; }
  try{
    await auth.signInWithEmailAndPassword(email, pass);
    // on success, show dashboard
    showView('adminDash');
    document.getElementById('adminLoginBtn').classList.add('hidden');
    document.getElementById('adminLogoutBtn').classList.remove('hidden');
    setupAdminListeners();
  }catch(e){ alert('Admin sign-in failed. Create admin user in Firebase Auth or check credentials.'); console.warn(e); }
};

document.getElementById('adminLogoutBtn').onclick = async ()=>{ await auth.signOut(); document.getElementById('adminLoginBtn').classList.remove('hidden'); document.getElementById('adminLogoutBtn').classList.add('hidden'); showView('adminLogin'); };

async function setupAdminListeners(){
  // listen users
  db.collection('users').orderBy('lastAttempt','desc').onSnapshot(snap=>{
    const users = []; snap.forEach(d=>users.push({id:d.id,...d.data()}));
    document.getElementById('userList').innerHTML = users.map(u=>`<div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:6px"><strong>${u.name||'—'}</strong><div class=\"muted\">${u.email||''} ${u.phone? '• '+u.phone : ''}</div></div>`).join('');
    document.getElementById('totalUsers').textContent = users.length;
  }, err=>console.warn('users listen err', err));

  // listen attempts/results
  db.collection('results').orderBy('createdAt','desc').limit(50).onSnapshot(snap=>{
    const r = []; snap.forEach(d=>r.push({id:d.id,...d.data()}));
    document.getElementById('attemptList').innerHTML = r.map(a=>`<div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:6px"><div style=\"display:flex;justify-content:space-between\"><strong>${a.userName||'Anon'}</strong><span class=\"muted\">${a.category} • ${a.score}%</span></div><div class=\"muted\">${a.userEmail||''} ${a.userPhone? '• '+a.userPhone : ''}</div></div>`).join('');
    document.getElementById('totalAttempts').textContent = r.length;
  }, err=>console.warn('results listen err', err));
}

/* =========================
   Init: restore local user if present and start splash
   ========================= */
(function(){
  const u = localStorage.getItem('mera_user'); if(u){ try{ state.user = JSON.parse(u); document.getElementById('u_name').value=state.user.name||''; document.getElementById('u_email').value=state.user.email||''; document.getElementById('u_phone').value=state.user.phone||''; }catch(e){} }
  startSplash();
})();

</script></body>
  </html>
